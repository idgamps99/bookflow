<div class="book-detail-container" data-controller="toggle" >
  <div class="book-detail-header">
    <div class="book-detail-cover-container">
      <%= image_tag @book.cover_url.present? ? @book.cover_url : 'Discover/missingbook.jpeg', alt: @book.title, class: "book-detail-cover" %>
    </div>
    <div class="book-detail-info">
      <h1><%= @book.title %></h1>
      <p>by <%= @book.author %></p>
      <br>
      <p><strong>Published Year:</strong> <%= @book.year_published %></p>
      <p><strong>Genre:</strong> <%= @book.genre %></p>
      <p><strong>Page Count:</strong> <%= @book.page_count %> pages</p>
      <p>
        <strong>Overall Rating:</strong>
        <i class="fas fa-star" style="color: #FFD700;"></i>
        <%= @book.overall_rating == @book.overall_rating ? @book.overall_rating : number_with_precision(@book.overall_rating, precision: 1) %>
        / 5
      </p>
    </div>
  </div>

  <p><strong>Summary:</strong></p>
  <p class="book-detail-summary"><%= @book.summary %></p>
<!--
  <div id="reading-list-actions" data-controller="reading-list-session-button">
    <%= button_to "Add to Reading List", book_reading_lists_path(@book), method: :post, class: "book-detail-add-button", id: "add-to-reading-list-btn", data: { action:"click->reading-list-session-button#fireReview", turbo_method: :post } %>
    <div id="confirmation-message" data-reading-list-session-button-target="message" class="d-none">
      <p>Your book has been added to your reading list!</p>
      <button type="button" id="start-reading-session-btn" data-reading-list-session-button-target="button" class="book-detail-start-reading-session-btn d-none" data-action="click->toggle#fireStartReadingSession">Start Tracking</button>
    </div>
  </div> -->

<% if current_user.reading_lists.where(book_id: @book.id, active: true).exists? %>
  <div>
    <p><%= "Added" %></p>
    <% if @reading_list.active %>
      <%= link_to "Go to Tracker", reading_list_path(@reading_list) %>
    <% else %>
      <%= button_to "start Tracker", reading_list_trackers_path(@reading_list), method: :post %>
    <% end %>
  </div>
<% else %>
  <%= button_to "Add to Reading List", book_reading_lists_path(@book), method: :post, class: "book-detail-add-button", id: "add-to-reading-list-btn", data: { turbo_method: :post } %>
<% end %>
<h3>Reviews</h3>

  <!-- Review Form Toggle -->
  <div >
    <button type="button" data-action="click->toggle#fireReview" class="book-detail-leave-review-btn">Leave a Review</button>
    <div data-toggle-target="togglableElement" class="d-none">
      <div id="review-form">
        <h3>Leave a Review for <%= @book.title %></h3>
        <%= simple_form_for([@book, @book.reviews.new], html: { autocomplete: "off" }) do |f| %>
          <%= f.input :title, label: "Title", autocomplete: "off", class: "input-title" %>
          <%= f.input :content, autocomplete: "off", class: "input-content" %>
          <%= f.input :rating, label: "Rating (0-5)", autocomplete: "off", class: "input-rating" %>
          <%= f.button :submit, value: "Submit Review", class: "book-detail-submit-review-btn" %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Reviews Display -->
  <% @book.reviews.each do |review| %>
    <div class="review">
      <h5><%= review.title %></h5>
      <p><%= review.content %></p>
      <p>Rating: <%= review.rating %></p>

      <!-- Edit & Delete Options for the User's Own Review -->
      <% if review.user == current_user %>
        <button type="button" data-action="click->toggle#fireEdit" class="edit-review-btn">Edit Review</button>
        <div data-toggle-target="toggleEdit" class="d-none">
          <div id="edit-form">
            <h2>Edit review for <%= @book.title %></h2>
               <%= simple_form_for([@book, review], url: book_review_path(@book, review)) do |f| %>
              <%= f.input :title, label: "Title", class: "input-title" %>
              <%= f.input :content, class: "input-content" %>
              <%= f.input :rating, label: "Rating (0-5)", class: "input-rating" %>
              <%= f.button :submit, value: "Update Review", class: "submit-review-btn" %>
            <% end %>
          </div>
        </div>
        <%= link_to "Delete", book_review_path(@book, review), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "delete-review-btn" %>
      <% end %>
    </div>
  <% end %>
</div>
